{% extends "web/poem_base.html" %}

{% block poem_content%}
    <div id="poem-text-container">
        {{ poem.html_text|safe }}
    </div>
{% endblock%}

{% block poem_right_content%}
    <div class="btn-group" data-toggle="buttons" id="versions-selector">
        <input type="radio" class="btn-check" name="verze" id="puvodni" autocomplete="off">
        <label class="btn btn-outline-primary" for="puvodni">Původní verze</label>
        
        <input type="radio" class="btn-check" name="verze" id="editorska" autocomplete="off" checked>
        <label class="btn btn-outline-primary" for="editorska">Editorská verze</label>
    </div>
    Básně v knize <a href="{%url 'book_detail' id=poem.book.id %}">{{ poem.book.title|safe }}</a>:
    <ol>
        {% for p in poems_in_book %}
        {% if p.id == poem.id %}
            <li>{{ p|safe }}</li>
        {% else %}
            <li><a href="{% url 'poem_in_book' id=p.id %}">{{ p|safe }}</a></li>
        {% endif %}
        {% empty %}
        <li>V této knize nejsou žádné básně.</li>
        {% endfor %}
    </ol>
{% endblock %}


{% block extra_js %}
<script>
    $(document).ready( function () {
        var headingHeight = getElementHeightWithMargin(document.querySelector('nav')) 
                        +  getElementHeightWithMargin(document.querySelector('#page-title-wrapper'))
                        + getElementHeightWithMargin(document.querySelector('footer'))
                        +  44; 
        $('#book-content-wrapper').height(document.documentElement.clientHeight - headingHeight);

        var komentars = document.querySelectorAll('komentar');
        komentars.forEach(function(komentar) {
            var dataText = komentar.getAttribute('data-text');
            komentar.setAttribute('title', dataText);
        });
        
        $('komentar').tooltip()

        if(!document.querySelector('#poem-text-container').querySelector('verze')) {
            document.querySelector('#versions-selector').style.display = 'none';
        }
        
        // Listen to change event on radio buttons
        document.querySelectorAll('input[name="verze"]').forEach(function (radio) {
            radio.addEventListener('change', function () {
                // Display Původní verze content
                if (document.getElementById('puvodni').checked) {
                    document.querySelectorAll('verze[typ="puvodni"]').forEach(function(verze) {
                        verze.style.display = 'inline';
                    });
                    document.querySelectorAll('verze[typ="editorska"]').forEach(function(verze) {
                        verze.style.display = 'none';
                    });
                }
                // Display Editorská verze content
                else {
                    document.querySelectorAll('verze[typ="puvodni"]').forEach(function(verze) {
                        verze.style.display = 'none';
                    });
                    document.querySelectorAll('verze[typ="editorska"]').forEach(function(verze) {
                        verze.style.display = 'inline';
                    });
                }
            });
        });
    });
</script>
{% endblock %}